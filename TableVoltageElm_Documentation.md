# TableVoltageElm - Table Voltage Source

## Overview

The `TableVoltageElm` is a specialized voltage rail that gets its voltage value from computed values generated by other circuit elements, particularly the `TableElm`. It extends `RailElm` to provide a single-terminal voltage source to ground, creating a simpler interface than traditional two-terminal voltage sources. This allows you to create feedback loops where computed values (like column sums in a table) drive voltage rails in the circuit.

## Features

- **Single Terminal Rail**: Extends RailElm for simplified single-terminal operation to ground
- **Computed Value Reference**: Gets voltage from computed values by name
- **DC Bias**: Optional DC offset added to the computed value
- **Non-linear Element**: Updates voltage source in real-time during simulation
- **Simple Configuration**: Only two editable parameters for ease of use

## Usage

1. **Add to Circuit**: Use the menu "Inputs and Sources > Add Table Voltage Source"
2. **Configure Reference**: Set the "Computed Value Name" to match a computed value
3. **Set Bias (Optional)**: Add a DC offset if needed
4. **Connect**: Wire from the single terminal (automatically grounded internally)

## Configuration Parameters

### Computed Value Name
- **Type**: String (text field)
- **Default**: "Col1"
- **Purpose**: Name of the computed value to reference
- **Examples**: 
  - "Col1", "Col2" - Column sums from TableElm
  - "MySum" - Custom computed values from other elements

### DC Bias (V)
- **Type**: Numeric (-20V to +20V range)
- **Default**: 0V
- **Purpose**: DC offset added to the computed voltage
- **Formula**: `Output Voltage = Computed Value + DC Bias`

## How It Works

1. **Voltage Calculation**: During each simulation step, the element:
   - Looks up the computed value by name using `LabeledNodeElm.getComputedValue()`
   - Adds the DC bias to get the final voltage
   - Updates the voltage source in the circuit matrix

2. **Non-linear Behavior**: 
   - Element is marked as non-linear (`nonLinear() returns true`)
   - `doStep()` method is called each iteration to update voltage
   - Ensures real-time tracking of computed values

3. **Integration with TableElm**:
   - TableElm generates column sums as computed values
   - Column headers become the computed value names
   - TableVoltageElm can reference these by name

## Example Circuit

```
Voltage Source (5V) 
    ↓
Labeled Node "Col1" (measures voltage)
    ↓ 
Table Element (displays "Col1", computes sum)
    ↓
Table Voltage Source (references "Col1" sum)
    ↓
Load Resistor
    ↓
Ground
```

## Circuit File Format

The TableVoltageElm uses dump type 256 and saves:
```
256 x1 y1 x2 y2 flags computed_value_name dc_bias
```

Example:
```
256 416 144 416 112 0 Col1 0
```
This creates a TableVoltageElm from (416,144) to (416,112) referencing "Col1" with 0V bias.

## Error Handling

- **Missing Computed Value**: Returns 0V + DC bias if computed value not found
- **Invalid Name**: Empty or null names default to "Col1"
- **Convergence**: Participates in circuit convergence checking

## Integration Points

### With TableElm
- TableElm calculates column sums in `stepFinished()`
- Registers sums as computed values using column headers as names
- TableVoltageElm references these computed values by name

### With LabeledNodeElm
- Uses `LabeledNodeElm.getComputedValue()` and `setComputedValue()`
- Extends the labeled node system for computed values
- Allows other elements to also generate computed values

## Implementation Details

### Class Hierarchy
```
CircuitElm
    └── VoltageElm
            └── TableVoltageElm
```

### Key Methods
- `getVoltage()`: Returns computed value + bias
- `stamp()`: Stamps DC voltage source with current computed voltage  
- `doStep()`: Updates voltage source each iteration
- `nonLinear()`: Returns true for real-time updates
- `getEditInfo()`: Provides text field for computed value name
- `setEditValue()`: Handles user edits to computed value name

### File I/O
- `dump()`: Saves computed value name with circuit
- `TableVoltageElm(StringTokenizer)`: Loads computed value name from file

## Usage Tips

1. **Naming Convention**: Use descriptive names for computed values (e.g., "PowerSum", "AvgVoltage")
2. **Feedback Loops**: Be careful with feedback - computed values driving voltage sources that affect the computation
3. **Convergence**: Complex feedback may require smaller time steps for convergence
4. **Testing**: Use scope elements to verify computed values are updating correctly

## Comparison to Other Voltage Sources

| Feature | DCVoltageElm | ACVoltageElm | ExtVoltageElm | TableVoltageElm |
|---------|--------------|--------------|---------------|-----------------|
| Voltage Source | Fixed DC | AC waveforms | JavaScript | Computed values |
| Real-time Updates | No | Yes (time-based) | Yes (external) | Yes (circuit-based) |
| Configuration | Voltage only | Multiple params | Name only | Name + bias |
| Use Case | Simple DC | Signal generation | External control | Circuit feedback |

## Limitations

- Only references computed values, cannot generate them
- Requires other elements (like TableElm) to create computed values
- Simple DC output only (no waveform generation)
- No built-in scaling or mathematical operations on computed values