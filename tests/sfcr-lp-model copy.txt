# LP SFC Model - Godley & Lavoie Chapter 5
# This file demonstrates the SFCR-compatible text format for CircuitJS1
# Based on: Monetary Economics: An Integrated Approach to Credit, Money, Income, Production and Wealth
# by Wynne Godley and Marc Lavoie, chapter 5.
# Reference: https://joaomacalos.github.io/sfcr/articles/articles/gl3-lp.html

#===============================================================================
# BALANCE SHEET MATRIX
#===============================================================================

@matrix Balance_Sheet
columns: Households, Firms, Government, Central_Bank
codes: h, f, g, cb
type: balance_sheet

| Stock           | h               | f           | g           | cb          |
|-----------------|-----------------|-------------|-------------|-------------|
| Money           | H_h             |             |             | -H_s        |
| Bills           | B_h             |             | -B_s        | B_cb        |
| Bonds           | BL_h * p_bl     |             | -BL_s * p_bl|             |
| Balance         | -V              |             | V           |             |

@end_matrix


#===============================================================================
# TRANSACTION FLOW MATRIX
#===============================================================================

@matrix Transaction_Flow_Matrix
columns: Households, Firms, Government, CB_Current, CB_Capital
codes: h, f, g, cbc, cbk
type: transaction_flow

| Flow              | h                   | f         | g                   | cbc                 | cbk           |
|-------------------|---------------------|-----------|---------------------|---------------------|---------------|
| Consumption       | -C                  | C         |                     |                     |               |
| Govt Expenditure  |                     | G         | -G                  |                     |               |
| Income            | Y                   | -Y        |                     |                     |               |
| Int. on Bills     | r_b * B_h   |           | -r_b * B_s  | r_b * B_cb  |               |
| Int. on Bonds     | BL_h                |           | -BL_s           |                     |               |
| CB profits        |                     |           | r_b * B_cb  | -r_b * B_cb |               |
| Taxes             | -TX                 |           | TX                  |                     |               |
| Ch. Money         | -\DeltaH_h          |           |                     |                     | \DeltaH_s     |
| Ch. Bills         | -\DeltaB_h          |           | \DeltaB_s           |                     | -\DeltaB_cb   |
| Ch. Bonds         | -\DeltaBL_h * p_bl  |           | \DeltaBL_h * p_bl   |                     |               |

@end_matrix


#===============================================================================
# EQUATIONS - National Income
#===============================================================================

@equations national_income
  Y ~ C + G                                           # eq1: GDP identity
  YD_r ~ Y - TX + r_b[-1] * B_h[-1] + BL_h[-1]       # eq2: Disposable income (regular)
  TX ~ \theta * (Y + r_b[-1] * B_h[-1] + BL_h[-1])   # eq3: Taxes
@end


#===============================================================================
# EQUATIONS - Household Wealth
#===============================================================================

@equations household_wealth
  V ~ V[-1] + (YD_r - C) + CG                        # eq4: Wealth accumulation
  CG ~ (p_bl - p_bl[-1]) * BL_h[-1]                  # eq5: Capital gains on bonds
  V_E ~ V[-1] + (YD_Er - C) + CG                     # eq7: Expected wealth
@end


#===============================================================================
# EQUATIONS - Consumption
#===============================================================================

@equations consumption
  C ~ \alpha_1 * YD_Er + \alpha_2 * V[-1]            # eq6: Consumption function
@end


#===============================================================================
# EQUATIONS - Portfolio Allocation
#===============================================================================

@equations portfolio
  H_h ~ V - B_h - p_bl * BL_h                        # eq8: Money demand (residual)
  H_d ~ V_E - B_d - p_bl * BL_d                      # eq9: Desired money demand
  
  # eq10: Demand for bills (portfolio choice)
  B_d ~ (V_E * \lambda_20) + V_E * (\lambda_22 * r_b + \lambda_23 * ERr_bl) + \lambda_24 * YD_Er
  
  # eq11: Demand for bonds (portfolio choice)
  BL_d ~ V_E * (\lambda_30 + \lambda_32 * r_b + \lambda_33 * ERr_bl + \lambda_34 * (YD_Er / V_E)) / p_bl
  
  B_h ~ B_d                                          # eq12: Bills held = bills demanded
  BL_h ~ BL_d                                        # eq13: Bonds held = bonds demanded
@end


#===============================================================================
# EQUATIONS - Government Sector
#===============================================================================

@equations government
  # eq14: Government bills supply
  B_s ~ B_s[-1] + (G + r_b[-1] * B_s[-1] + BL_s[-1]) - (TX + r_b[-1] * B_cb[-1]) - (\DeltaBL_s * p_bl)
  
  BL_s ~ BL_h                                        # eq17: Bonds supply = bonds held
@end


#===============================================================================
# EQUATIONS - Central Bank
#===============================================================================

@equations central_bank
  H_s ~ H_s[-1] + \DeltaB_cb                         # eq15: Money supply
  B_cb ~ B_s - B_h                                   # eq16: CB holdings of bills (residual)
@end


#===============================================================================
# EQUATIONS - Interest Rates and Expectations
#===============================================================================

@equations rates_expectations
  ERr_bl ~ r_bl + \chi * ((pe_bl - p_bl) / p_bl)    # eq18: Expected return on bonds
  r_bl ~ 1 / p_bl                                    # eq19: Bond yield
  pe_bl ~ p_bl                                       # eq20: Expected bond price (baseline)
  CGE ~ \chi * (pe_bl - p_bl) * BL_h                # eq21: Expected capital gains
  YD_Er ~ YD_r[-1]                                   # eq22: Expected disposable income
@end


#===============================================================================
# EQUATIONS - Changes (Deltas)
#===============================================================================

@equations deltas
  \DeltaH_h ~ diff(H_h)                             # Change in household money
  \DeltaH_s ~ diff(H_s)                             # Change in money supply
  \DeltaB_h ~ diff(B_h)                             # Change in household bills
  \DeltaB_s ~ diff(B_s)                             # Change in government bills
  \DeltaB_cb ~ diff(B_cb)                           # Change in CB bills
  \DeltaBL_h ~ diff(BL_h)                           # Change in household bonds
  \DeltaBL_s ~ diff(BL_s)                           # Change in government bonds
@end


#===============================================================================
# PARAMETERS (Exogenous Variables)
#===============================================================================

@parameters Parameters
  G = 20                              # Government expenditure
  r_b = 0.03                          # Interest rate on bills
  p_bl = 20                           # Price of bonds (perpetuities)
  \theta = 0.1938                     # Tax rate
  \alpha_1 = 0.8                      # Propensity to consume out of expected income
  \alpha_2 = 0.2                      # Propensity to consume out of wealth
  \lambda_20 = 0.44196                # Portfolio parameter (bills constant)
  \lambda_22 = 1.1                    # Portfolio parameter (bills/bill rate)
  \lambda_23 = -1                     # Portfolio parameter (bills/bond return)
  \lambda_24 = -0.03                  # Portfolio parameter (bills/income)
  \lambda_30 = 0.3997                 # Portfolio parameter (bonds constant)
  \lambda_32 = -1                     # Portfolio parameter (bonds/bill rate)
  \lambda_33 = 1.1                    # Portfolio parameter (bonds/bond return)
  \lambda_34 = -0.03                  # Portfolio parameter (bonds/income)
  \chi = 0.1                          # Weight of expected capital gains in bond return
@end


#===============================================================================
# HINTS (Variable Documentation)
#===============================================================================

@hints
  Y: National income (GDP)
  C: Consumption
  G: Government expenditure
  YD_r: Regular household disposable income
  YD_Er: Expected household disposable income
  TX: Taxes
  V: Household wealth
  V_E: Expected household wealth
  CG: Capital gains on bonds
  CGE: Expected capital gains on bonds
  H_h: Cash money held by households
  H_d: Desired cash money
  H_s: Cash money supplied by central bank
  B_h: Bills held by households
  B_d: Desired bills
  B_s: Bills supplied by government
  B_cb: Bills held by central bank
  BL_h: Bonds held by households
  BL_d: Desired bonds
  BL_s: Bonds supplied by government
  p_bl: Price of bonds (perpetuities)
  pe_bl: Expected price of bonds
  r_b: Interest rate on bills
  r_bl: Interest rate on bonds (yield)
  ERr_bl: Expected rate of return on bonds
  \theta: Tax rate
  \alpha_1: Propensity to consume out of expected income
  \alpha_2: Propensity to consume out of wealth
  \lambda_20: Portfolio allocation parameter (bills intercept)
  \lambda_22: Portfolio allocation parameter (bills response to bill rate)
  \lambda_23: Portfolio allocation parameter (bills response to bond return)
  \lambda_24: Portfolio allocation parameter (bills response to income)
  \lambda_30: Portfolio allocation parameter (bonds intercept)
  \lambda_32: Portfolio allocation parameter (bonds response to bill rate)
  \lambda_33: Portfolio allocation parameter (bonds response to bond return)
  \lambda_34: Portfolio allocation parameter (bonds response to income)
  \chi: Weight of expected capital gains in expected bond return
  \DeltaH_h: Change in household money holdings
  \DeltaH_s: Change in money supply
  \DeltaB_h: Change in household bill holdings
  \DeltaB_s: Change in government bills
  \DeltaB_cb: Change in central bank bill holdings
  \DeltaBL_h: Change in household bond holdings
  \DeltaBL_s: Change in government bonds
@end


#===============================================================================
# HIDDEN EQUATION (Model Closure)
#===============================================================================

# Hidden equation for model consistency check:
# H_s = H_h (Money supplied = Money demanded)
# This is the redundant equation that validates stock-flow consistency

@hidden H_s = H_h


#===============================================================================
# SCOPES (Variables to display in oscilloscope)
#===============================================================================

@scope Y
@scope C
@scope V
@scope B_h
@scope BL_h
@scope H_h
